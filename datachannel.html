<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'none'; script-src 'nonce-s33kr1t'; navigate-to 'none'">

    <script type="text/javascript" nonce="s33kr1t">
        window.addEventListener("message", (e) => {
            console.warn("Running test:", e.data);

            (async () => {
                const conn1 = new RTCPeerConnection();
                const data = conn1.createDataChannel("label");
                const offer = await conn1.createOffer();
                await conn1.setLocalDescription(offer);

                const conn2 = new RTCPeerConnection();
                await conn2.setRemoteDescription(offer);
                const answer = await conn2.createAnswer();
                await conn2.setLocalDescription(answer);

                await conn1.setRemoteDescription(answer);

                const ufrag1 = offer.sdp.match(/\sa=ice-ufrag:([^\s]+)/)[1];
                conn2.onconnectionstatechange = (e) => console.warn(conn2.connectionState, e);
                await conn2.addIceCandidate(new RTCIceCandidate({
                    candidate: [
                        "candidate:0 1 UDP 9999999",
                        "37.16.6.18 1234",
                        "typ host",
                    ].join(" "),
                    sdpMid: "0",
                    sdpMLineIndex: 0,
                    usernameFragment: ufrag1,
                }));

                // WIP
                // window.parent.postMessage(e.data.page);
            })();
        });
    </script>
</head>

<body></body>

</html>
